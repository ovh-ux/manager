<div>
    <oui-header
        id="web-pass-add-header"
        class="mb-3 add-page-header"
        data-heading="{{ $ctrl.selectedProject ? 'web_paas_add_project_title_edit' : 'web_paas_add_project_title' | translate }}"
        data-description="{{:: 'web_paas_add_project_description' | translate }}"
    >
    </oui-header>
    <div class="container-fluid">
        <div
            id="web-pass-add-alert"
            data-ovh-alert="{{$ctrl.alerts.add}}"
        ></div>
        <oui-stepper
            data-on-finish="$ctrl.createWebPaas()"
            current-index="$ctrl.stepperIndex"
        >
            <oui-step-form
                data-header="{{:: 'web_paas_add_project_name' | translate }}"
                data-submit-text="{{:: 'web_paas_add_project_next' | translate }}"
                data-prevent-next="true"
                data-valid="$ctrl.project.name"
                data-navigation="$ctrl.project.name"
                data-editable="$ctrl.isEditable()"
                data-loading="$ctrl.loadingCapabilities"
            >
                <oui-field data-size="xl">
                    <input
                        class="oui-input mb-2"
                        type="text"
                        id="projectName"
                        name="projectName"
                        data-ng-model="$ctrl.project.name"
                        required
                    />
                </oui-field>
            </oui-step-form>

            <oui-step-form
                data-header="{{:: 'web_paas_add_project_choose_offer' | translate }}"
                data-description="{{:: 'web_paas_add_project_choose_offer_description' | translate }}"
                data-submit-text="{{:: 'web_paas_add_project_next' | translate }}"
                data-prevent-next="true"
                data-valid="$ctrl.project.offer"
                data-navigation="$ctrl.project.offer"
                data-on-submit="$ctrl.onPlanSubmit()"
            >
                <web-paas-offers
                    data-offers="$ctrl.catalog.productList"
                    data-user="$ctrl.user"
                    data-disabled="false"
                    data-on-select="$ctrl.onPlanSelect(product)"
                    data-on-focus="$ctrl.onOfferFocus()"
                    data-on-submit="$ctrl.onOfferSubmit(form)"
                    data-preview-mode="!$ctrl.isEditingOffers"
                    data-selected-plan="$ctrl.selectedProject.selectedPlan"
                >
                </web-paas-offers>
            </oui-step-form>

            <oui-step-form
                data-ng-if="!$ctrl.isChangingPlan()"
                data-header="{{:: 'web_paas_add_project_region' | translate }}"
                data-submit-text="{{:: 'web_paas_add_project_next' | translate }}"
                data-valid="$ctrl.project.region"
                data-navigation="$ctrl.project.region"
                data-prevent-next="true"
                data-loading="$ctrl.loadingCapabilities"
            >
                <div class="row mb-3">
                    <oui-select-picker
                        class="col-md-4 mb-3"
                        name="projectRegion"
                        disabled="$ctrl.project.region && $ctrl.capabilities.regions.length === 1"
                        data-ng-if="$ctrl.capabilities.regions"
                        data-ng-repeat="region in $ctrl.capabilities.regions track by $index"
                        data-model="$ctrl.project.region"
                        data-variant="light"
                        data-label="{{ region }}"
                        data-values="[true]"
                        required
                    >
                    </oui-select-picker>
                </div>
            </oui-step-form>

            <oui-step-form
                data-ng-if="!$ctrl.isChangingPlan()"
                data-header="{{:: 'web_paas_add_project_template' | translate}}"
                data-submit-text="{{:: 'web_paas_add_project_next' | translate }}"
                data-prevent-next="true"
                data-valid="$ctrl.project.template.createNew || $ctrl.project.template.templateUrl"
                data-navigation="$ctrl.project.template.createNew || $ctrl.project.template.templateUrl"
                data-editable="!isAdding"
                data-loading="$ctrl.loadingCapabilities"
                data-on-focus="$ctrl.onTemplateFocus()"
                data-on-submit="$ctrl.onTemplateSubmit(form)"
            >
                <div class="row mb-3">
                    <oui-select-picker
                        class="col-md-4 mb-3"
                        name="templateNew"
                        data-model="$ctrl.project.template.createNew"
                        data-label="{{:: 'web_paas_add_project_template_create_title' | translate }}"
                        data-variant="light"
                        data-on-change="$ctrl.onSelected(modelValue)"
                        data-values="[true]"
                        data-ng-if="$ctrl.isEditingTemplate || $ctrl.project.template.createNew"
                    >
                        <oui-select-picker-section>
                            <span
                                data-translate="web_paas_add_project_template_create_description"
                            ></span>
                        </oui-select-picker-section>
                    </oui-select-picker>
                    <oui-select-picker
                        class="col-md-4 mb-3"
                        name="templateExiting"
                        data-model="$ctrl.project.template.createNew"
                        data-label="{{:: 'web_paas_add_project_template_existing_title' | translate }}"
                        data-variant="light"
                        data-on-change="$ctrl.onSelected(modelValue)"
                        data-values="[false]"
                        data-ng-if="$ctrl.isEditingTemplate || !$ctrl.project.template.createNew"
                    >
                        <oui-select-picker-section>
                            <span
                                data-translate="web_paas_add_project_template_existing_description"
                            ></span>
                        </oui-select-picker-section>
                    </oui-select-picker>
                </div>
                <web-paas-project-template
                    data-ng-if="!$ctrl.project.template.createNew"
                    data-project="$ctrl.project"
                    data-templates="$ctrl.capabilities.templates"
                    data-disabled="false"
                    data-on-select="$ctrl.onTemplateSelect(template)"
                    data-preview-mode="!$ctrl.isEditingTemplate"
                >
                </web-paas-project-template>
            </oui-step-form>

            <oui-step-form
                data-ng-if="!$ctrl.isChangingPlan() || $ctrl.additionalLicenceEdit"
                data-header="{{:: 'web_paas_add_project_options' | translate }}"
                data-submit-text="{{:: 'web_paas_add_project_next' | translate }}"
                data-loading="$ctrl.isGettingAddons"
                data-on-submit="$ctrl.onOptionsSubmit()"
            >
                <div class="w-75" data-ng-if="!$ctrl.additionalLicenceEdit">
                    <web-paas-additional-option
                        data-ng-repeat="addon in $ctrl.selectedPlan.addons track by $index"
                        option="addon"
                        plan="$ctrl.selectedPlan"
                    >
                    </web-paas-additional-option>
                </div>
                <div data-ng-if="$ctrl.additionalLicenceEdit">
                    <web-paas-user-list
                        user-list="$ctrl.userList"
                        delete-user="$ctrl.deleteUser"
                    ></web-paas-user-list>
                </div>
            </oui-step-form>
            <oui-step-form
                data-header="{{:: 'web_paas_add_project_license_summary_title' | translate }}"
                data-loading="$ctrl.isGettingCheckoutInfo || $ctrl.orderInProgress"
                data-submit-text="{{:: ($ctrl.isChangingPlan() ? 'web_paas_add_project_title_edit' : 'web_paas_add_project_next') | translate }}"
                data-cancel-text="{{ ::'web_paas_common_cancel' | translate }}"
                data-on-cancel="$ctrl.goBack()"
            >
                <div>
                    <h5
                        data-translate="web_paas_add_project_license_summary_offer"
                    ></h5>
                    <span data-ng-bind="$ctrl.selectedPlan.invoiceName"></span>
                    <div
                        data-ng-repeat="addon in $ctrl.selectedPlan.addons track by $index"
                    >
                        <span
                            data-ng-if="addon.family === 'staging_environment' && addon.quantity > 0"
                            data-translate="web_paas_add_project_license_summary_addon_environment"
                            data-translate-values="{quantity: addon.quantity}"
                        >
                        </span>
                        <span
                            data-ng-if="addon.family === 'storage' && addon.quantity > 0"
                            data-translate="web_paas_add_project_license_summary_addon_storage"
                            data-translate-values="{quantity: (addon.quantity * 5)}"
                        ></span>
                        <span
                            data-ng-if="addon.family === 'user_license' && addon.quantity > 0"
                            data-translate="web_paas_add_project_license_summary_addon_user_licence"
                            data-translate-values="{quantity: addon.quantity}"
                        ></span>
                    </div>
                </div>
                <div class="mt-3">
                    <h5
                        data-translate="web_paas_add_project_license_summary_total"
                    ></h5>
                    <div>
                        <dl data-class="col-md-2">
                            <dt
                                data-translate="web_paas_add_project_license_total_price_without_tax"
                            ></dt>
                            <dd
                                data-ng-bind="$ctrl.prices.withoutTax.text"
                            ></dd>
                            <dt
                                data-translate="web_paas_add_project_license_total_price_with_tax"
                            ></dt>
                            <dd data-ng-bind="$ctrl.prices.withTax.text"></dd>
                        </dl>
                    </div>
                </div>
            </oui-step-form>
        </oui-stepper>
    </div>
</div>
