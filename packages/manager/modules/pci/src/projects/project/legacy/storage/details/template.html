<section class="cui-page__content" data-ng-init="getPage();">
    <a class="oui-button oui-button_link oui-button_icon-left" data-ui-sref="pci.projects.project.legacy.compute.storage">
        <i class="oui-icon oui-icon-chevron-left" aria-hidden="true"></i>
        <span data-translate="common_back" translate="storage_add_button_return"></span>
    </a>

    <cui-page-content-title data-text="title"></cui-page-content-title>

    <cui-message-container data-messages="messages"></cui-message-container>

    <button type="button"
        class="oui-button oui-button_secondary"
        data-ng-click="addObjects()"
        data-ng-disabled="errors.notdefined || errors.notfound"
        write-right-required>
            {{ 'storage_object_add_multiple' | translate }}
    </button>

    <div class="container-infos rows clearfix" data-ng-if="!loaders.details && !errors.notfound && !errors.notdefined.notdefined && !errors.notfound && !errors.notdefined.notfound">
        <div class="pull-left" data-ng-if="storage.shortcut">
            <cloud-project-compute-storage-icon
                data-type="storage.shortcut">
            </cloud-project-compute-storage-icon>
        </div>
        <dl class="container-infos-list" data-ng-class="{ 'container-infos-list_no-icon': !storage.shortcut }">
                <dt data-translate="storage_nb_objects"></dt>
                <dd data-ng-bind="objects.length"></dd>
                <dd class="container-infos-list-item">
                    <span class="container-infos-list-item-label" data-translate="storage_container_size"></span>{{ computeStorageSize() | showByte }}
                </dd>
                <dd class="container-infos-list-item" data-ng-show="url">
                    <span class="container-infos-list-item-label" data-ng-show="url" data-translate="storage_container_url"></span>
                    <span class="container-infos-list-item-label word-wrap" data-uib-tooltip="{{ :: 'storage_container_url_info' | translate }}">
                        {{ url }}
                        <i class="glyphicon glyphicon-question-sign pointer"></i>
                    </span>
                </dd>
                <dd class="container-infos-list-item" data-ng-if="storage.shortcut == 'swift_cname'">
                        <span class="container-infos-list-item-label" data-translate="storage_static_url"></span>
                        {{ storage.staticUrl }}
                        <i class="glyphicon glyphicon-question-sign pointer" data-ng-click="openDNSHelp()" />
                </dd>
                <div data-ng-if="storage.shortcut === 'pca'">
                    <dd class="container-infos-list-item">
                        <span class="container-infos-list-item-label" data-translate="storage_gateway"></span>gateways.storage.{{ storage.region.toLowerCase() }}.cloud.ovh.net
                    </dd>
                    <dd class="container-infos-list-item">
                        <span class="container-infos-list-item-label" data-translate="storage_gateway_username"></span>{{CLOUD_PCA_FILE_STATE.USERNAME}}
                    </dd>
                    <dd class="container-infos-list-item">
                        <span class="container-infos-list-item-label" data-translate="storage_gateway_password"></span><span data-ng-bind="getPcaPassword()"></span>
                    </dd>
                </div>
        </dl>
    </div>

    <promise-task-state></promise-task-state>

    <div class="callout callout-error" data-ng-if="errors.notfound">
        <h3 data-translate="storage_details_not_found"></h3>
    </div>

    <div class="callout callout-error" data-ng-if="errors.notdefined">
        <h3 data-translate="storage_details_not_defined"></h3>
    </div>

    <div class="callout callout-warning"
         data-ng-if="objects.length == 0 && !loaders.details && !errors.notfound && !errors.notdefined">
        <h3 data-translate="storage_no_files_title"></h3>
        <p data-translate="storage_no_files"></p>

    </div>

    <div data-ng-if="storage.shortcut !== 'pca'">
        <oui-datagrid data-rows="files">
            <oui-column data-title="'storage_file_name' | translate" data-property="name" data-sortable></oui-column>
            <oui-column data-title="'storage_last_modify' | translate" data-property="lastModified" data-sortable>
                {{$row.lastModified | date:'medium'}}
            </oui-column>
            <oui-column data-title="'storage_size' | translate" data-property="size" data-sortable>
                {{$row.size | RAUnitsBits}}
            </oui-column>
            <oui-column data-title="'storage_file_type' | translate" data-property="contentType" data-sortable></oui-column>
            <oui-column data-title="'storage_file_download' | translate">
                <button class="oui-button oui-button_secondary"
                        data-ng-click="fileDownload($row)"
                        data-translate="storage_file_download"></button>
            </oui-column>

            <oui-action-menu data-align="end" data-compact>
                <oui-action-menu-item data-text="{{'storage_delete_button' | translate}}"
                                      data-on-click="delete($row)"></oui-action-menu-item>
            </oui-action-menu>
        </oui-datagrid>
    </div>
    <div data-ng-if="storage.shortcut === 'pca'">
        <oui-datagrid data-rows="files">
            <oui-column data-title="'storage_file_name' | translate" data-property="name" data-sortable></oui-column>
            <oui-column data-title="'storage_last_modify' | translate" data-property="lastModified" data-sortable>
                {{$row.lastModified | date:'medium'}}
            </oui-column>
            <oui-column data-title="'storage_size' | translate" data-property="size" data-sortable>
                {{$row.size | RAUnitsBits}}
            </oui-column>
            <oui-column data-title="'storage_file_type' | translate" data-property="contentType" sortable></oui-column>
            <oui-column data-title="'storage_file_download' | translate" data-property="retrievalState" sortable>
                <div data-ng-show="$row.sealingStateLoading" class="text-center">
                    <oui-spinner size="s"></oui-spinner>
                </div>
                <span data-ng-hide="$row.sealingStateLoading" data-ng-switch="$row.retrievalState">
                    <div data-ng-switch-when="sealed">
                        <button type="button" class="ovh-button ovh-button_secondary" data-ng-bind="$row.stateText" data-ng-click="fileDownload($row)" data-uib-tooltip="{{'storage_file_state_sealed' | translate }}" data-tooltip-trigger="mouseenter"></button>
                    </div>
                    <div data-ng-switch-when="unsealing">
                        <button type="button" class="oui-button oui-button_secondary" data-ng-bind="$row.stateText" data-ng-click="fileDownload($row)" data-uib-tooltip="{{'storage_file_state_unsealing' | translate }}" data-tooltip-trigger="mouseenter"></button>
                    </div>
                    <div data-ng-switch-when="unsealed">
                        <button type="button" class="oui-button oui-button_secondary" data-ng-bind="$row.stateText" data-ng-click="fileDownload($row)" data-uib-tooltip="{{'storage_file_state_unsealed' | translate }}" data-tooltip-trigger="mouseenter"></button>
                    </div>
                </span>
            </oui-column>

            <oui-action-menu data-align="end" data-compact>
                <oui-action-menu-item data-text="{{'storage_delete_button' | translate}}"
                                      data-on-click="delete($row)"></oui-action-menu-item>
            </oui-action-menu>
        </oui-datagrid>
    </div>

    <div class="table-pretty-pagination"
         data-ng-show="!loaders.details && !errors.notfound && !errors.notdefined && objects.length > 5"
         data-pagination-front
         data-items="objects"
         data-paginated-items="files"
         data-current-page="currentPage"
         data-nb-pages="nbPages"
         data-items-per-page="filesPerPage"
         data-page-placeholder="{{ 'common_pagination_page' | translate:{currentPage: currentPage, nbPages : nbPages} }}"
         data-item-per-page-placeholder="{{ 'common_pagination_display' | translate }}">
    </div>

</section>
