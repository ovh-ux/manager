<div class="container-fluid mb-1">
    <div data-ovh-alert="{{:: $ctrl.alertSection }}"></div>
    <div
        class="text-center"
        data-ng-if="$ctrl.loader.loading && !$ctrl.loader.error"
    >
        <oui-spinner></oui-spinner>
    </div>
    <div data-ng-if="!$ctrl.loader.loading && !$ctrl.loader.error">
        <p class="text-danger" data-ng-if="$ctrl.isServerHacked()">
            <span
                data-translate="bm_server_ipmi_disabled"
                data-translate-values="{
                    serverState: ('bm_server_state_' + $ctrl.server.state | translate)
                }"
            >
            </span>
        </p>
        <div data-ng-if="!$ctrl.isServerHacked()">
            <div data-ng-if="!$ctrl.ipmi.isActivated()">
                <div data-ng-if="!$ctrl.kvm.featuresAvailable()">
                    <p data-translate="bm_server_ipmi_off"></p>
                    <div data-ng-if="$ctrl.kvm.canOrderKvm()">
                        <p data-translate="bm_server_ipmi_off_kvm"></p>
                        <button
                            type="button"
                            class="btn btn-default"
                            data-ng-click="$ctrl.orderKvm()"
                        >
                            <span
                                class="oui-icon oui-icon-cart"
                                aria-hidden="true"
                            ></span>
                            <span
                                data-translate="bm_server_ipmi_order_kvm"
                            ></span>
                        </button>
                    </div>
                </div>
                <div data-ng-if="$ctrl.kvm.featuresAvailable()">
                    <h3 data-translate="bm_server_kvm_informations"></h3>
                    <dl class="oui-description">
                        <dt
                            data-translate="bm_server_kvm_informations_name"
                        ></dt>
                        <dd data-ng-bind="$ctrl.kvm.name"></dd>
                        <dt data-translate="bm_server_kvm_informations_ip"></dt>
                        <dd data-ng-bind="$ctrl.kvm.ip"></dd>
                        <dt
                            data-translate="bm_server_kvm_informations_expiration"
                        ></dt>
                        <dd
                            data-ng-bind="$ctrl.kvm.expiration | date:'longDate'"
                        ></dd>
                    </dl>
                </div>
            </div>
            <div
                class="text-danger"
                data-ng-if="$ctrl.ipmi.isActivated() && ($ctrl.disable.otherTask || $ctrl.disable.localTask)"
                data-translate="bm_server_ipmi_disable"
            ></div>
            <div
                class="row d-md-flex mb-5"
                data-ng-if="$ctrl.ipmi.isActivated() && !$ctrl.disable.otherTask && !$ctrl.disable.localTask"
            >
                <div class="col-md-4">
                    <oui-tile
                        class="h-100"
                        data-heading="{{::'bm_server_tile_kvm_heading' | translate}}"
                        data-description="{{::'bm_server_tile_kvm_description' | translate}}"
                    >
                        <oui-tile-definition
                            data-ng-if="$ctrl.ipmi.isKvmIpHtml5UrlSupported()"
                        >
                            <oui-tile-description>
                                <button
                                    type="button"
                                    class="btn btn-default btn-block"
                                    data-ng-click="$ctrl.getIpmiKvmUrl()"
                                    data-ng-disabled="$ctrl.loader.buttonStart || $ctrl.disable.otherTask || $ctrl.disable.localTask"
                                >
                                    <span
                                        data-translate="bm_server_ipmi_kvm_console"
                                    ></span>
                                    <oui-spinner
                                        class="ml-2"
                                        data-ng-if="$ctrl.loader.kvmhtmlLoading"
                                        data-size="s"
                                    >
                                    </oui-spinner>
                                </button>
                                <a
                                    class="btn btn-default btn-block"
                                    href="{{:: $ctrl.loader.kvmUrl }}"
                                    target="_blank"
                                    rel="noopener"
                                    data-ng-if="$ctrl.loader.kvmUrlReady && !$ctrl.disable.otherTask && !$ctrl.disable.localTask"
                                    data-translate="bm_server_ipmi_kvm_url"
                                >
                                </a>
                            </oui-tile-description>
                        </oui-tile-definition>
                        <oui-tile-definition
                            data-ng-if="$ctrl.ipmi.isKvmIpJnlpSupported()"
                        >
                            <oui-tile-description>
                                <button
                                    type="button"
                                    class="btn btn-default btn-block"
                                    data-ng-click="$ctrl.startIpmiJava()"
                                    data-ng-disabled="$ctrl.loader.buttonStart || $ctrl.disable.otherTask || $ctrl.disable.localTask"
                                >
                                    <span
                                        data-translate="bm_server_ipmi_java"
                                    ></span>
                                    <oui-spinner
                                        class="ml-2"
                                        data-ng-if="$ctrl.loader.javaLoading"
                                        data-size="s"
                                    >
                                    </oui-spinner>
                                </button>
                                <button
                                    type="button"
                                    class="btn btn-default btn-block"
                                    data-ng-if="$ctrl.appletToDownload"
                                    data-ng-click="$ctrl.downloadApplet()"
                                    data-translate="bm_server_ipmi_java_download"
                                ></button>
                            </oui-tile-description>
                        </oui-tile-definition>
                    </oui-tile>
                </div>
                <div class="col-md-4">
                    <oui-tile
                        class="h-100"
                        data-heading="{{::'bm_server_tile_sol_heading' | translate}}"
                        data-description="{{::'bm_server_tile_sol_description' | translate}}"
                    >
                        <oui-tile-definition data-ng-if="$ctrl.hasSOL()">
                            <oui-tile-description>
                                <button
                                    type="button"
                                    class="btn btn-default btn-block"
                                    data-ng-click="$ctrl.startIpmiNavigation()"
                                    data-ng-disabled="$ctrl.loader.buttonStart || $ctrl.disable.otherTask || $ctrl.disable.localTask"
                                >
                                    <span
                                        data-translate="bm_server_ipmi_navigation"
                                    ></span>
                                    <oui-spinner
                                        class="ml-2"
                                        data-ng-if="$ctrl.loader.navigationLoading"
                                        data-size="s"
                                    >
                                    </oui-spinner>
                                </button>
                                <a
                                    class="btn btn-default btn-block"
                                    href="{{ $ctrl.loader.navigationReady }}"
                                    target="_blank"
                                    rel="noopener"
                                    data-ng-if="$ctrl.loader.navigationReady && !$ctrl.disable.otherTask && !$ctrl.disable.localTask"
                                    data-translate="bm_server_ipmi_navigation_go"
                                >
                                </a>
                            </oui-tile-description>
                        </oui-tile-definition>
                        <oui-tile-definition
                            data-term="{{::'bm_server_ssh_sol_definition' | translate}}"
                        >
                            <oui-tile-description>
                                <oui-select
                                    data-placeholder="{{::'bm_server_ssh_select' | translate}}"
                                    data-items="$ctrl.ssh.list"
                                    data-model="$ctrl.ssh.selectedKey"
                                    data-on-change="$ctrl.onSelectSshKey()"
                                    data-disabled="$ctrl.loader.solSshKeyLoading || $ctrl.loader.buttonStart || $ctrl.disable.otherTask || $ctrl.disable.localTask"
                                >
                                    <span ng-bind="$item"></span>
                                </oui-select>
                                <oui-spinner
                                    class="ml-2"
                                    data-ng-if="$ctrl.loader.solSshKeyLoading"
                                    data-size="s"
                                >
                                </oui-spinner>
                                <oui-clipboard
                                    data-model="'ssh ' + $ctrl.ssh.solSshUrl"
                                    data-ng-if="$ctrl.ssh.solSshUrl"
                                ></oui-clipboard>
                            </oui-tile-description>
                        </oui-tile-definition>
                    </oui-tile>
                </div>
                <div class="col-md-4">
                    <button
                        type="button"
                        class="btn btn-default btn-block"
                        data-ng-click="$ctrl.restartIpmi()"
                        data-ng-disabled="$ctrl.disable.restartIpmi || $ctrl.disable.localTask || $ctrl.disable.otherTask"
                    >
                        <span>
                            <span
                                data-translate="bm_server_ipmi_reset_interfaces"
                            ></span>
                            <span
                                class="label label-defaut"
                                data-ng-if="$ctrl.disable.restartIpmi"
                                data-translate="bm_server_doing"
                            ></span>
                        </span>
                    </button>
                    <button
                        type="button"
                        class="btn btn-default btn-block"
                        data-ng-click="$ctrl.startIpmiTest()"
                        data-ng-disabled="$ctrl.disable.testIpmi || $ctrl.disable.otherTask || $ctrl.disable.localTask"
                    >
                        <span>
                            <span data-translate="bm_server_ipmi_test"></span>
                            <span
                                class="label label-defaut"
                                data-ng-if="$ctrl.disable.testIpmi"
                                data-translate="bm_server_doing"
                            >
                            </span>
                        </span>
                    </button>
                </div>
            </div>
            <div
                data-ng-if="$ctrl.ipmi.isActivated() && !$ctrl.disable.otherTask && !$ctrl.disable.localTask"
            >
                <p data-translate="bm_server_ipmi_monitoring_warning"></p>
                <p data-ng-if="$ctrl.ipmiHelpUrl && $ctrl.hasSOL()">
                    <span data-translate="bm_server_ipmi_SOL_help"></span>
                    <a
                        data-ng-href="{{::$ctrl.ipmiHelpUrl}}"
                        target="_blank"
                        rel="noopener"
                    >
                        <span
                            data-translate="bm_server_ipmi_SOL_help_link"
                        ></span>
                        <span
                            class="oui-icon oui-icon-external-link"
                            aria-hidden="true"
                        >
                        </span>
                    </a>
                </p>
            </div>
        </div>
    </div>

    <div data-ng-if="$ctrl.ipmi.isActivated() && $ctrl.disable.testActive">
        <ul class="list-unstyled">
            <li>
                <oui-spinner
                    data-ng-if="$ctrl.loader.httpLoading"
                    data-size="s"
                ></oui-spinner>
                <span
                    class="oui-icon oui-icon-error text-danger"
                    data-ng-if="$ctrl.loader.httpError"
                >
                </span>
                <span
                    class="oui-icon oui-icon-success text-success"
                    data-ng-if="$ctrl.loader.httpDone"
                >
                </span>
                <span
                    class="ml-2"
                    data-ng-class="{ 'font-weight-bold': loader.httpLoading }"
                    data-translate="bm_server_ipmi_http"
                >
                </span>
            </li>
            <li>
                <oui-spinner
                    data-ng-if="$ctrl.loader.passwordLoading"
                    data-size="s"
                >
                </oui-spinner>
                <span
                    class="oui-icon oui-icon-error text-danger"
                    data-ng-if="$ctrl.loader.passwordError"
                >
                </span>
                <span
                    class="oui-icon oui-icon-success text-success"
                    data-ng-if="$ctrl.loader.passwordDone"
                >
                </span>
                <span
                    class="ml-2"
                    data-ng-class="{ 'font-weight-bold': $ctrl.loader.passwordLoading }"
                    data-translate="bm_server_ipmi_password"
                >
                </span>
            </li>
            <li>
                <oui-spinner
                    data-ng-if="$ctrl.loader.pingLoading"
                    data-size="s"
                >
                </oui-spinner>
                <span
                    class="oui-icon oui-icon-error text-danger"
                    data-ng-if="$ctrl.loader.pingError"
                >
                </span>
                <span
                    class="oui-icon oui-icon-success text-success"
                    data-ng-if="$ctrl.loader.pingDone"
                >
                </span>
                <span
                    class="ml-2"
                    data-ng-class="{ 'font-weight-bold': $ctrl.loader.pingLoading }"
                    data-translate="bm_server_ipmi_ping"
                >
                </span>
            </li>
        </ul>
    </div>
</div>
